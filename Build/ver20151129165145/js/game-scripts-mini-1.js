(function(e,t,n){"use strict";var r=qc.defineBehaviour("qc.Plugins.NodeFadeInOut",qc.Tween,function(){this.fadeType=r.FADE_IN,this.columnCount=1,this.rowCount=1,this.pivotX=.5,this.pivotY=.5,this.fadeStyle=r.STYLE_ZOOM,this.fadeEffect=r.EFFECT_XY,this.target=null},{fadeType:qc.Serializer.NUMBER,columnCount:qc.Serializer.NUMBER,rowCount:qc.Serializer.NUMBER,pivotX:qc.Serializer.NUMBER,pivotY:qc.Serializer.NUMBER,fadeStyle:qc.Serializer.NUMBER,fadeEffect:qc.Serializer.NUMBER,target:qc.Serializer.NODE});r.__menu="Plugins/NodeFadeInOut",t.defineProperties(r.prototype,{columnCount:{get:function(){return this._columnCount},set:function(e){e=isNaN(e)||e===0?1:e;if(e===this._columnCount)return;this._columnCount=e}},rowCount:{get:function(){return this._rowCount},set:function(e){e=isNaN(e)||e===0?1:e;if(e===this._rowCount)return;this._rowCount=e}},_cachedTarget:{get:function(){return this.target&&this.target._destroy&&(this.target=null),this.target||this.gameObject}}}),r.prototype.onEnable=function(){if(this._cachedTarget._destroy)return;this._cachedTarget.visible=!0,this._cachedTexture&&(this._cachedTexture.destroy(!0),this._cachedTexture=null),this._cachedBounds=this._cachedTarget.localBounds,this._cachedTexture=this._cachedTarget.generateTexture(),this._cachedSprite=new PIXI.Sprite(this._cachedTexture),this._cachedSprite.worldTransform=this._cachedTarget.worldTransform,this._cachedTarget.phaser.anchor&&(this._cachedSprite.anchor=this._cachedTarget.phaser.anchor),this._nodeRenderCanvas||(this._nodeRenderCanvas=this.gameObject.phaser._renderCanvas,this.gameObject.phaser._renderCanvas=this.renderCanvas.bind(this)),this._nodeRenderWebGL||(this._nodeRenderWebGL=this.gameObject.phaser._renderWebGL,this.gameObject.phaser._renderWebGL=this.renderWebGL.bind(this))},r.prototype.onDisable=function(){this._nodeRenderCanvas&&(this.gameObject.phaser._renderCanvas=this._nodeRenderCanvas,this._nodeRenderCanvas=null),this._nodeRenderWebGL&&(this.gameObject.phaser._renderWebGL=this._nodeRenderWebGL,this._nodeRenderWebGL=null),this._cachedTexture&&(this._cachedTexture.destroy(!0),this._cachedTexture=null),this._cachedSprite&&(this._cachedSprite=null),qc.Tween.prototype.onDisable.call(this)},r.prototype.onDestroy=function(){this._nodeRenderCanvas&&(this.gameObject.phaser._renderCanvas=this._nodeRenderCanvas,this._nodeRenderCanvas=null),this._nodeRenderWebGL&&(this.gameObject.phaser._renderWebGL=this._nodeRenderWebGL,this._nodeRenderWebGL=null),this._cachedTexture&&(this._cachedTexture.destroy(!0),this._cachedTexture=null),this._cachedSprite&&(this._cachedSprite=null),qc.Tween.prototype.onDestroy&&qc.Tween.prototype.onDestroy.call(this)},r.prototype.onUpdate=function(e,t){this._factorValue=this.fadeType===r.FADE_IN?1-e:e,t&&!this._cachedTarget._destroy&&this._cachedTarget===this.gameObject&&(this._cachedTarget.visible=this.fadeType===r.FADE_IN)},r.prototype.renderCanvas=function(e){this._cachedTarget!==this.gameObject&&this._nodeRenderCanvas.call(this.gameObject.phaser,e);var t=this._cachedTexture,n=this._cachedSprite,i=this._cachedBounds;if(t){var s=t.baseTexture.resolution/e.resolution;e.context.globalAlpha=n.worldAlpha,e.smoothProperty&&e.scaleMode!==t.baseTexture.scaleMode&&(e.scaleMode=t.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===PIXI.scaleModes.LINEAR);var o=t.trim?t.trim.x-n.anchor.x*t.trim.width:n.anchor.x*-t.frame.width,u=t.trim?t.trim.y-n.anchor.y*t.trim.height:n.anchor.y*-t.frame.height;e.roundPixels?(e.context.setTransform(n.worldTransform.a,n.worldTransform.b,n.worldTransform.c,n.worldTransform.d,n.worldTransform.tx*e.resolution|0,n.worldTransform.ty*e.resolution|0),o|=0,u|=0):e.context.setTransform(n.worldTransform.a,n.worldTransform.b,n.worldTransform.c,n.worldTransform.d,n.worldTransform.tx*e.resolution,n.worldTransform.ty*e.resolution);var a=t.crop.width/this.columnCount,f=t.crop.height/this.rowCount,l=this.fadeEffect===r.EFFECT_X||this.fadeEffect===r.EFFECT_XY,c=this.fadeEffect===r.EFFECT_Y||this.fadeEffect===r.EFFECT_XY,h=(l?1-this._factorValue:1)*a/s,p=(c?1-this._factorValue:1)*f/s,d=l&&this.fadeStyle===r.STYLE_CLIP?a*(1-this._factorValue):a,v=c&&this.fadeStyle===r.STYLE_CLIP?f*(1-this._factorValue):f;for(var m=0;m<t.crop.height;m+=f){var g=(u+m+f*(c?this._factorValue:0)*this.pivotY)/s+i.y;for(var y=0;y<t.crop.width;y+=a){var b=(o+y+a*(l?this._factorValue:0)*this.pivotX)/s+i.x;e.context.drawImage(t.baseTexture.source,t.crop.x+y,t.crop.y+m,d,v,b,g,h,p)}}}},r.prototype.renderWebGL=function(e){this._cachedTarget!==this.gameObject&&this._nodeRenderWebGL.call(this.gameObject.phaser,e);var t=this._cachedTexture,n=this._cachedBounds,i=this._cachedSprite,s=t._uvs;if(!s)return;var o=t.baseTexture.resolution/e.resolution,u=t.crop.width/this.columnCount,a=t.crop.height/this.rowCount,f=this.fadeEffect===r.EFFECT_X||this.fadeEffect===r.EFFECT_XY,l=this.fadeEffect===r.EFFECT_Y||this.fadeEffect===r.EFFECT_XY,c=(f?1-this._factorValue:1)*u/o,h=(l?1-this._factorValue:1)*a/o,p=f&&this.fadeStyle===r.STYLE_CLIP?u*(1-this._factorValue):u,d=l&&this.fadeStyle===r.STYLE_CLIP?a*(1-this._factorValue):a,v=i.worldTransform,m=v.a/o,g=v.b/o,y=v.c/o,b=v.d/o,w=v.tx,E=v.ty,S=s.x2-s.x0,x=s.y2-s.y0;for(var T=0;T<t.crop.height;T+=a){var N=(T+a*(l?this._factorValue:0)*this.pivotY)/o+n.y;for(var C=0;C<t.crop.width;C+=u){var k=(C+u*(f?this._factorValue:0)*this.pivotX)/o+n.x;this._webGLAddQuad(e.spriteBatch,i,k,N,k+c,N+h,s.x0+S*C/t.crop.width,s.y0+x*T/t.crop.height,s.x0+S*(C+p)/t.crop.width,s.y0+x*(T+d)/t.crop.height,m,g,y,b,w,E,i.tint)}}},r.prototype._webGLAddQuad=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){e.currentBatchSize>=e.size&&(e.flush(),e.currentBaseTexture=t.texture.baseTexture);var g=e.colors,y=e.positions,b=e.currentBatchSize*4*e.vertSize;e.renderSession.roundPixels?(y[b]=l*n+h*r+d|0,y[b+1]=p*r+c*n+v|0,y[b+5]=l*i+h*r+d|0,y[b+6]=p*r+c*i+v|0,y[b+10]=l*i+h*s+d|0,y[b+11]=p*s+c*i+v|0,y[b+15]=l*n+h*s+d|0,y[b+16]=p*s+c*n+v|0):(y[b]=l*n+h*r+d,y[b+1]=p*r+c*n+v,y[b+5]=l*i+h*r+d,y[b+6]=p*r+c*i+v,y[b+10]=l*i+h*s+d,y[b+11]=p*s+c*i+v,y[b+15]=l*n+h*s+d,y[b+16]=p*s+c*n+v),y[b+2]=o,y[b+3]=u,y[b+7]=a,y[b+8]=u,y[b+12]=a,y[b+13]=f,y[b+17]=o,y[b+18]=f,g[b+4]=g[b+9]=g[b+14]=g[b+19]=(m>>16)+(m&65280)+((m&255)<<16)+(t.worldAlpha*255<<24),e.sprites[e.currentBatchSize++]=t},r.FADE_IN=0,r.FADE_OUT=1,r.STYLE_ZOOM=0,r.STYLE_CLIP=1,r.EFFECT_XY=0,r.EFFECT_X=1,r.EFFECT_Y=2;var i=qc.defineBehaviour("qc.demo.LoadingUI",qc.Behaviour,function(){this.clue=null},{clue:qc.Serializer.NODE});i.prototype.awake=function(){var e=this;e.game.state.onStartLoad.add(function(){e.show()}),e.game.state.onEndLoad.add(function(){e.gameObject.visible&&(e.duringTween?e.nextChange=1:e.hide())})},i.prototype.update=function(){var e=this,t=e.game.assets.loaded,n=e.game.assets.total;n?e.clue.text="拼命加载中："+t+"/"+n:e.clue.text="",e.gameObject.parent.setChildIndex(this.gameObject,e.gameObject.parent.children.length-1)},i.prototype.show=function(){var e=this,t=e.gameObject.getScript("qc.Plugins.NodeFadeInOut");e.gameObject.visible=!0,e.gameObject.alpha=0,t.stop(),t.enable=!1,t.target=e.gameObject.game.world,t.fadeType=r.FADE_OUT,t.fadeStyle=this.getRandomInt(0,2),t.fadeEffect=this.getRandomInt(0,3),t.pivotX=Math.random(0,1),t.pivotY=Math.random(0,1),t.columnCount=this.getRandomInt(1,32),t.rowCount=this.getRandomInt(1,32),t.resetToBeginning(),t.playForward(),e.gameObject.alpha=1,e.duringTween=!0,t.onFinished.addOnce(function(){e.duringTween=!1,e.nextChange&&(e.hide(),e.nextChange=0)})},i.prototype.hide=function(){var e=this,t=e.gameObject.getScript("qc.Plugins.NodeFadeInOut");e.gameObject.alpha=1,t.enable=!1,t.target=null,t.fadeType=r.FADE_OUT,t.fadeStyle=this.getRandomInt(0,2),t.fadeEffect=this.getRandomInt(0,3),t.pivotX=Math.random(0,1),t.pivotY=Math.random(0,1),t.columnCount=this.getRandomInt(1,32),t.rowCount=this.getRandomInt(1,32),t.resetToBeginning(),t.playForward(),e.duringTween=!0,t.onFinished.addOnce(function(){e.gameObject.visible=!1,e.duringTween=!1,e.nextChange=0})},i.prototype.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e}}).call(this,this,Object)